csr

Cd network

rm -rf crypto-config/
rm -f channel-artifacts/*
../bin/cryptogen generate --config=./crypto-config.yaml

../bin/configtxgen -profile FiveOrgsCsrOrdererGenesis -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block

../bin/configtxgen -profile FiveOrgsCsrChannel  -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID funchannel

../bin/configtxgen -profile FiveOrgsCsrChannel -outputAnchorPeersUpdate ./channel-artifacts/CorporateMSPanchors.tx -channelID funchannel -asOrg CorporateMSP
../bin/configtxgen -profile FiveOrgsCsrChannel -outputAnchorPeersUpdate ./channel-artifacts/CreditsAuthorityMSPanchors.tx -channelID funchannel -asOrg CreditsAuthorityMSP
../bin/configtxgen -profile FiveOrgsCsrChannel -outputAnchorPeersUpdate ./channel-artifacts/NgoMSPanchors.tx -channelID funchannel -asOrg NgoMSP

../bin/configtxgen -profile FiveOrgsCsrChannel -outputAnchorPeersUpdate ./channel-artifacts/ItDepartmentMSPanchors.tx -channelID funchannel -asOrg ItDepartmentMSP
../bin/configtxgen -profile FiveOrgsCsrChannel -outputAnchorPeersUpdate ./channel-artifacts/CitizenMSPanchors.tx -channelID funchannel -asOrg CitizenMSP

export CORPORATE_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/corporate.csr.com/ca && ls *_sk)
export CREDITS_AUTHORITY_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/creditsauthority.csr.com/ca && ls *_sk)
export NGO_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/ngo.csr.com/ca && ls *_sk)

export IT_DEPARTMENT_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/itdepartment.csr.com/ca && ls *_sk)
export CITIZEN_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/citizen.csr.com/ca && ls *_sk)

docker-compose -f docker-compose-ca.yaml -f docker-compose-e2e.yaml -f docker-compose-couch.yaml up -d

docker exec -it cli bash



Environmental variables

CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/corporate.csr.com/users/Admin@corporate.csr.com/msp
CORE_PEER_ADDRESS=peer0.corporate.csr.com:7051
CORE_PEER_LOCALMSPID=CorporateMSP
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/corporate.csr.com/peers/peer0.corporate.csr.com/tls/ca.crt

CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/creditsauthority.csr.com/users/Admin@creditsauthority.csr.com/msp
CORE_PEER_ADDRESS=peer0.creditsauthority.csr.com:9051
CORE_PEER_LOCALMSPID=CreditsAuthorityMSP
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/creditsauthority.csr.com/peers/peer0.creditsauthority.csr.com/tls/ca.crt

CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/ngo.csr.com/users/Admin@ngo.csr.com/msp
CORE_PEER_ADDRESS=peer0.ngo.csr.com:11051
CORE_PEER_LOCALMSPID=NgoMSP
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/ngo.csr.com/peers/peer0.ngo.csr.com/tls/ca.crt

CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_LOCALMSPID="Org1MSP"
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_LOCALMSPID="Org1MSP"
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

Creating the channel

peer channel create -o orderer.csr.com:7050 -c funchannel -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem

peer channel join -b funchannel.block

peer channel update -o orderer.csr.com:7050 -c funchannel -f ./channel-artifacts/CorporateMSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem

peer channel update -o orderer.csr.com:7050 -c funchannel -f ./channel-artifacts/CreditsAuthorityMSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem

peer channel update -o orderer.csr.com:7050 -c funchannel -f ./channel-artifacts/NgoMSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem

peer chaincode install -n mycc -v 1.0 -p github.com/chaincode/chaincode_example02/go/

peer chaincode instantiate -o orderer.csr.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem -C funchannel -n mycc -v 1.0 -c '{"Args":["init","a", "300", "b","400"]}' -P "AND ('CorporateMSP.peer','CreditsAuthorityMSP.peer','NgoMSP.peer')"


peer chaincode query -C funchannel -n mycc -c '{"Args":["query","a"]}'

peer chaincode invoke -o orderer.csr.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/csr.com/orderers/orderer.csr.com/msp/tlscacerts/tlsca.csr.com-cert.pem -C funchannel -n mycc --peerAddresses peer0.corporate.csr.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/corporate.csr.com/peers/peer0.corporate.csr.com/tls/ca.crt --peerAddresses peer0.ngo.csr.com:11051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/ngo.csr.com/peers/peer0.ngo.csr.com/tls/ca.crt --peerAddresses peer0.creditsauthority.csr.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/creditsauthority.csr.com/peers/peer0.creditsauthority.csr.com/tls/ca.crt -c '{"Args":["invoke","a","b","10"]}'

docker rm -f $(docker ps -aq)
docker volume prune -f
docker network prune -f
docker system  prune -f






